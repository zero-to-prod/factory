#!/usr/bin/env php
<?php

/**
 * Zero-to-Prod Factory Documentation Publisher
 * 
 * Publishes the README.md file to the user's documentation directory.
 */

$default_target_path = $_SERVER['HOME'] . '/docs/zero-to-prod/factory/';
$source_file = __DIR__ . '/../README.md';

// Parse command line arguments
$target_path = $default_target_path;
if (isset($argv[1])) {
    $target_path = rtrim($argv[1], '/') . '/';
}

// Validate source file exists
if (!file_exists($source_file)) {
    fwrite(STDERR, "Error: Source README.md not found at {$source_file}\n");
    exit(1);
}

// Create target directory if it doesn't exist
if (!is_dir($target_path)) {
    if (!mkdir($target_path, 0755, true) && !is_dir($target_path)) {
        fwrite(STDERR, "Error: Could not create target directory: {$target_path}\n");
        exit(1);
    }
    echo "Created directory: {$target_path}\n";
}

$target_file = $target_path . 'README.md';

// Copy the README file
if (copy($source_file, $target_file)) {
    echo "âœ“ Published README.md to: {$target_file}\n";
    exit(0);
}

fwrite(STDERR, "Error: Failed to copy README.md to {$target_file}\n");
exit(1);